#!/bin/bash

set -e

function show_rev() {
    rev=$1
    git log -1 $rev --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset' --abbrev-commit --date=relative
    echo "  `git di $rev^..$rev | diffstat | tail -1`"
}

function branch() {
    git branch 2>/dev/null | grep -e '^*' | tr -d '\* '
}

if [[ $1 == "" ]]; then
    LOCAL=`branch`
else
    LOCAL=$1
fi

if [[ $2 == "" ]]; then
    REMOTE=origin/$LOCAL
else
    REMOTE=$2
fi

echo "changes from local ${LOCAL} to remote ${REMOTE}:"
echo

echo incoming:
for rev in `git rev-list $LOCAL..$REMOTE`; do
    show_rev $rev
done

echo
echo outgoing:
for rev in `git rev-list $REMOTE..$LOCAL`; do
    show_rev $rev
done

